const CACHE_NAME="cerita-nusantara-v1",urlsToCache=["/","/app.css","/app.bundle.js","/manifest.json","/images/logo.png","https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css","https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png","https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"];self.addEventListener("install",(e=>{console.log("Service Worker: Installing..."),e.waitUntil(caches.open(CACHE_NAME).then((e=>(console.log("Service Worker: Caching files"),e.addAll(urlsToCache)))).then((()=>self.skipWaiting())))})),self.addEventListener("activate",(e=>{console.log("Service Worker: Activating..."),e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME)return console.log("Service Worker: Clearing old cache"),caches.delete(e)}))))).then((()=>clients.claim())))})),self.addEventListener("push",(e=>{console.log("Service Worker: Push notification received",e);let t={title:"Story berhasil dibuat",options:{body:"Anda telah membuat story baru",icon:"/images/icon-192x192.png",badge:"/images/badge-72x72.png",vibrate:[200,100,200],tag:"story-notification",requireInteraction:!1,actions:[{action:"view",title:"Lihat Story",icon:"/images/checkmark.png"},{action:"close",title:"Tutup",icon:"/images/close.png"}],data:{url:"/#/home",storyId:null}}};if(e.data)try{const o=e.data.json();console.log("Push payload:",o),o.title&&(t.title=o.title),o.options&&(t.options={...t.options,...o.options}),o.options&&o.options.data&&(t.options.data={...t.options.data,...o.options.data})}catch(e){console.error("Error parsing push payload:",e)}const o=self.registration.showNotification(t.title,t.options);e.waitUntil(o)})),self.addEventListener("notificationclick",(e=>{console.log("Notification clicked:",e),e.notification.close();const t=e.action,o=e.notification.data||{};if("close"===t)return;let n=o.url||"/#/home";o.storyId&&(n=`/#/story/${o.storyId}`);const s=clients.openWindow(n);e.waitUntil(s)})),self.addEventListener("fetch",(e=>{"GET"===e.request.method&&(e.request.url.startsWith("chrome-extension://")||e.respondWith(fetch(e.request).then((t=>{const o=t.clone();return e.request.url.includes("/v1/")||caches.open(CACHE_NAME).then((t=>{t.put(e.request,o)})),t})).catch((()=>caches.match(e.request).then((t=>t||(e.request.url.includes("/v1/")?new Response(JSON.stringify({error:!0,message:"Anda sedang offline. Silakan cek koneksi internet."}),{headers:{"Content-Type":"application/json"},status:503}):e.request.headers.get("accept").includes("text/html")?caches.match("/"):new Response("Offline - Resource not available",{status:503,statusText:"Service Unavailable"}))))))))}));